<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

<link rel="icon" href="images/docs.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=home" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&family=Mulish:ital,wght@0,200..1000;1,200..1000&family=Raleway:ital,wght@0,100..900;1,100..900&family=Roboto+Mono:ital,wght@0,100..700;1,100..700&display=swap" rel="stylesheet">

      <link rel="preconnect" href="https://fonts.googleapis.com">
   <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Rubik:ital,wght@0,300..900;1,300..900&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Afacad+Flux:wght@100..1000&family=Dosis:wght@200..800&family=Fira+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=IBM+Plex+Sans:ital,wght@0,100..700;1,100..700&family=Montserrat:ital,wght@0,100..900;1,100..900&family=Mulish:ital,wght@0,200..1000;1,200..1000&family=Open+Sans:ital,wght@0,300..800;1,300..800&family=Sora:wght@100..800&display=swap" rel="stylesheet">

    

  <link rel="icon" href="icon.png">
  <title>Docs</title>
  <style>

      
       @import url('https://fonts.googleapis.com/css2?family=Abel&family=Fascinate+Inline&family=Ga+Maamli&family=Happy+Monkey&family=Jaro:opsz@6..72&family=Kumbh+Sans:wght@100..900&family=Lilita+One&family=Lobster&family=Pacifico&family=Permanent+Marker&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Protest+Guerrilla&family=Quantico:ital,wght@0,400;0,700;1,400;1,700&family=Silkscreen:wght@400;700&family=Tiny5&family=VT323&display=swap');



      
    * { margin: 0; padding: 0; box-sizing: border-box; font-family:"Lato";}
    body {  background: white; color: black; height: 100vh; display: flex; flex-direction: column; overflow:hidden; }
    .menu-bar {
        background: white; padding: 0px; display: flex; gap: 0px; border-bottom:whitesmoke 1px solid; 
    }
      
    .menu-bar button {
        display:inline-block;
        background: none; border: none; color: black; cursor: pointer; padding: 12px 16px; font-size: 14px;
        height:100%;
        margin-left:0px;margin-right:0px;
        
    }

    #editorToolbar {
  position: fixed; 
  bottom: 35px;        
  left: 10px;
  right: 10px;
  width: auto;       
  height: 60px;
  background: white;
  border: solid whitesmoke 1px;
  border-radius: 6px;
  overflow-x: scroll;
  padding: 0 10px;
  display: flex;
  gap: 8px;
  align-items: center;
  z-index: 10000;    
}

      #editor {
           line-height: 1.2;
          font-family:"Lato";
          /* Default font. PrintContent2() contains the default font when exporting. */
          }

      #editor span {

            line-height: inherit;

          }


 span {
  display: inline-block;
  vertical-align: baseline;
  line-height: 1;
  height: 1em;
}


      
      #editorToolbar button {
          
          background:transparent;
          border:none;
          padding:15px;
          padding-left:20px;
          padding-right:20px;
          cursor:pointer;
          
          }

      #editorToolbar button:hover {

          background:whitesmoke;

          }
      
      .menu-bar button:hover {
        /* color:dodgerblue; */
          background:whitesmoke;
        
          }

      .overview_title {
            font-size:34px;
          font-family:"Lato";
          display:block;
          margin-bottom:15px;
          margin-top:16px;
          
          }

      #overviewList {
         list-style-type:none;
     
          }

      #overviewList li {
         display:block;
          width:99%;
      
          
          }

      #overviewList li a {

          display:block;
          width:99%;
          margin:5px;
          background:whitesmoke;
          padding:10px;
          

           color:black;
          text-decoration:none;
}

      #overviewList li a:hover {
             background:#dbeffa !important;
          }

      
    .sidebar {
        width: 225px; background: white; overflow-y: auto; border-right: 1px solid whitesmoke;
        display:block;
        
        
          flex-shrink: 0;
  height: 100%;
  overflow-y: auto;
    
    }
      
    .sidebar h3 {
        padding: 10px; font-size: 14px; color: black; 
    }
      
    .sidebar ul {
        list-style: none; padding: 0 10px;
    }
      
    .sidebar li {
        margin-bottom: 4px; 
    }
    
      .sidebar a {
          display: block; padding: 6px; color: black; text-decoration: none; border-radius: 4px;
      }
      
   .sidebar a.active {
  background: #dbeffa !important; 
  color: dodgerblue !important; 
  font-weight: bold !important; 
}

.sidebar a:not(.active):hover {
  background: whitesmoke;
  color: black;
  font-weight: normal;
}

    .content-area { flex: 1; position: relative; padding: 10px; overflow: auto;  
  overflow-y: auto;
  height: 90vh;  padding-bottom:100px;}
    #editor { width: 100%; height: 100vh; overflow-y:scroll; overflow-x:hidden; background: white; color: black; caret-color: black; padding: 10px; outline: none; overflow: auto; white-space: pre-wrap; word-break: break-word; }
  
    .status-bar {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: 28px;
  background: whitesmoke;
  color:black;
  padding: 4px 10px;
  font-size: 12px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  z-index: 1000;
}

.chrome-alert-box {
  position: fixed;
  top: 40px;
  left: 50%;
  transform: translateX(-50%);
  background: #fff;
  border: 1px solid rgba(0, 0, 0, 0.2);
  border-radius: 12px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
  padding: 20px 24px;
  width: 360px;
  z-index: 9999;
  display: none;
  font-family: "Mulish", sans-serif;
  animation: fadeIn 0.15s ease;
  color: black;
}

.chrome-header {
  font-weight: bold;
  margin-bottom: 10px;
  font-size: 15px;
  color: black;
}

        #fakeColorPicker {
 padding:0px;
                  margin-right:10px;
                border-radius:50px;
                border:none;
                outline:none;
                padding:0;
                background:none;
            cursor:pointer;
                height:40px;
                width:40px;
              
                }

      #fakeColorPicker:hover {
        outline: solid whitesmoke 5px;
          }

      #fakeColorPicker:active {
        outline:solid dodgerblue 3px;
          transform: scale(1.01)
          }

            #colorPicker:focus {
            border:solid dodgerblue 1px;
               
                }

      #colorPicker, .colorPicker {
          opacity:0;
          width:0px;
          height:0px;
          margin:0px;
          padding:0px;
          }

.chrome-options {
  list-style-type: none;
  padding-left: 20px;
  margin: 0 0 20px 0;
}

.chrome-options li {
  cursor: pointer;
  padding: 6px 8px;
  border-radius: 6px;
  transition: background-color 0.15s ease;
  user-select: none;
  font-size: 14px;
    text-style-type:none;
  color: black;
}

.chrome-options li.selected {
  background-color: #834424;
    text-style-type:none;
  color: white;
  font-weight: 600;
}


@keyframes fadeIn {
  from { opacity: 0; transform: translateX(-50%) translateY(-10px); }
  to { opacity: 1; transform: translateX(-50%) translateY(0); }
}

      

      .confirm {
          padding:5px; 
          width:90px;
          margin:3px;
         float:right;
    }

      @media (max-width:800px) {
       .sidebar { display:none; }
          #menuBtn { 
       display:block;
              }
          #quit {
              display:none;
              }
          #nav_quit {
              display:block;
              }

          }

      @media (min-width:800px) {
    .sidebar { display:block !important; }

          #menuBtn { 
       display:none;
              }
          
          }

           .link {
        color:teal;
            text-decoration:underline;
            cursor:pointer;
            
            }

        .link:hover {
       color:blue;
            }

      

      #fontSelector, #sizeSelector {
  padding: 4px 6px;
  border: 1px solid whitesmoke;
  border-radius: 0px;
  font-size: 14px;
          border-top:none;
          border-bottom:none;
  background: white;
  cursor: pointer;
          outline:none;
}

.bottom_message {
  display:inline-block;
  margin-top:10px;
  margin-left:10px;
}


      /* ---- CODE‑VIEW SIDEBAR ---- */
#codeSidebar {
  position: fixed;
  top: 0;
  right: -100%;              /* start hidden off‑screen */
  width: 40%;
  max-width: 600px;
  height: 100%;
  background: #f5f5f5;
  border-left: 1px solid #ddd;
  box-shadow: -2px 0 8px rgba(0,0,0,0.1);
  display: flex;
  flex-direction: column;
  transition: right 0.3s ease;
  z-index: 20000;
}
#codeSidebar.open {
  right: 0;
}
#codeSidebar #codeHeader {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 12px;
  background: #eee;
  border-bottom: 1px solid #ddd;
  font-weight: bold;
}
#closeCodeBtn {
  background: none;
  border: none;
  font-size: 20px;
  cursor: pointer;
  line-height: 1;
}
#codeArea {
  flex: 1;
  width: 100%;
  border: none;
  padding: 12px;
  font-family: monospace;
  font-size: 14px;
  resize: none;
  outline: none;
}

      

      #codeBtn {
  margin-left: auto;
          margin-right:10px;
}


     
  </style>

    <style>
.material-symbols-outlined {
  font-variation-settings:
  'FILL' 0,
  'wght' 400,
  'GRAD' 0,
  'opsz' 24
}
</style>

    
</head>
<body>
  <div class="menu-bar">
      
<button onclick="quit()" id="quit">
    
<span class="material-symbols-outlined">apps</span>

</button>
      
       <button onclick="toggleMenu()" id="menuBtn">
           <span class="material-symbols-outlined">menu</span>
       </button>
    <button onclick="newDoc()"><span class="material-symbols-outlined">add</span></button>
      <button onclick="saveDoc()" id="saveBtn">Save</button>
    <button onclick="showOptions()" id="exportBtn">
        Export
    </button>
    
      <button onclick="loadContent()" id="openBtn">
        Open
      </button>
    <button onclick="closeDoc()" id="closeBtn">Close</button>
    <button onclick="deleteDoc()" id="deleteBtn">Delete</button>

          <button id="codeBtn">
              <span class="material-symbols-outlined">
code
</span>
          </button>

      
  </div>
  <div style="display: flex; flex: 1;">
    <div class="sidebar" id="sidebar">
      <h3>Docs</h3>
      <ul id="docList"></ul>
    </div>
    <div class="content-area" id="contentArea"><div id="editor" contenteditable="true"></div>
    

        
</div>
  </div>
  <div class="status-bar">
    <span id="statusName">Home</span>
    <span id="statusMsg"></span>
  
  </div>

    <input type="file" id="fileInput" style="display: none;" accept=".jcdoc">



<div id="chromePrompt" class="chrome-alert-box" style="display:none;">
  <div class="chrome-header">Choose how to save the document:</div>
  <ul class="chrome-options">
    <li>Save to Jamesy Creator</li>
    <li>Download as a .jcdoc</li>
       <li>Save as a .pdf</li>
      <li>Print</li>

  </ul>

  <button class="confirm" onclick="confirmChoice()" id="first_confirm">OK</button>
<button class="confirm" onclick="hideOptions()">Cancel</button>
    
</div>


<div id="addElements" class="chrome-alert-box" style="display:none;">
  <div class="chrome-header">Elements</div>
  <ul class="chrome-options">
    <li>Table</li>
    <li>Link</li>
       <li>Checkbox</li>
     
       <li>Image</li>

  </ul>

   <button class="confirm" onclick="addElement()" id="second_confirm">Add</button>
<button class="confirm" onclick="closeAddElements()">Cancel</button>
   
</div>


<!-- CODE‑VIEW SIDEBAR -->
<div id="codeSidebar">
  <div id="codeHeader">
    <span>HTML Editor</span>
    <button id="closeCodeBtn">&times;</button>
  </div>
  <textarea id="codeArea"></textarea>
</div>
    
<div style="position:fixed;top:100px;right:10px;cursor:pointer;z-index:9999;background:white;border:2px solid whitesmoke;border-radius:50%;padding:8px;" onclick="if(!window.jnotes){window.jnotes=document.createElement('div');with(window.jnotes.style){position='fixed';top='50px';left='50px';width='600px';height='400px';border='1px solid #ccc';background='white';zIndex=9999;resize='both';overflow='hidden';borderRadius='8px';boxShadow='0 4px 12px rgba(0,0,0,0.1)';}window.jnotes.innerHTML='<div id=\'jnotes-header\' style=\'background:#eee;padding:5px;cursor:move;font-family:sans-serif;font-size:14px;\'>🗒️ Notes <span style=\'float:right;cursor:pointer;\' onclick=\'this.parentNode.parentNode.remove();window.jnotes=null\'>❌</span></div><iframe src=\'https://jamesy-tech.github.io/jamesy-creator-notes/\' style=\'width:100%;height:calc(100% - 30px);border:none;\'></iframe>';document.body.appendChild(window.jnotes);drag(window.jnotes, window.jnotes.querySelector('#jnotes-header'));}"><img src='images/notes.png' style='width:32px;height:32px;display:block;'/></div><script>function drag(el, handle){let x=0,y=0,xs=0,ys=0;handle.onmousedown=e=>{e.preventDefault();xs=e.clientX;ys=e.clientY;document.onmouseup=()=>document.onmousemove=null;document.onmousemove=e=>{x=xs-e.clientX;y=ys-e.clientY;xs=e.clientX;ys=e.clientY;el.style.top=(el.offsetTop-y)+'px';el.style.left=(el.offsetLeft-x)+'px';};};}</script>

    
  <script>

      (function(){
  const codeBtn      = document.getElementById('codeBtn');
  const sidebar      = document.getElementById('codeSidebar');
  const closeBtn     = document.getElementById('closeCodeBtn');
  const codeArea     = document.getElementById('codeArea');
  const editor       = () => document.getElementById('editor');

  // Toggle sidebar
  function toggleCodeView() {
    sidebar.classList.toggle('open');
    if (sidebar.classList.contains('open')) {
      // populate codeArea with current HTML
      codeArea.value = editor().innerHTML;
      codeArea.focus();
    }
  }
  codeBtn.addEventListener('click', toggleCodeView);
  closeBtn.addEventListener('click', toggleCodeView);

  // When user types in codeArea, update the WYSIWYG editor
  codeArea.addEventListener('input', () => {
    editor().innerHTML = codeArea.value;
  });

  // Optional: if user edits the WYSIWYG editor, keep codeArea in sync
  // (e.g. after execCommand, paste, etc.)
  editor().addEventListener('input', () => {
    if (sidebar.classList.contains('open')) {
      codeArea.value = editor().innerHTML;
    }
  });
})();


      
 function changeColour() {
  const color = document.getElementById("colorPicker").value;
  const selection = window.getSelection();
  if (!selection.rangeCount) return;

  const range = selection.getRangeAt(0);

  const span = document.createElement('span');
  span.style.color = color;

  if (range.collapsed) {
      
    span.appendChild(document.createTextNode('\u200B'));
    range.insertNode(span);

    const newRange = document.createRange();
    newRange.setStart(span.firstChild, 1);
    newRange.collapse(true);
    selection.removeAllRanges();
    selection.addRange(newRange);
  } else {
    span.appendChild(range.extractContents());
    range.insertNode(span);

    const newRange = document.createRange();
    newRange.selectNodeContents(span);
    selection.removeAllRanges();
    selection.addRange(newRange);
  }
}


      

  function quit() {
    window.close()
    setTimeout(() => {
       window.location.href = "https://jamesy-tech.github.io/jamesy-creator/";
    }, 100);
  }
    


function insertAtCaret(html, element = document.getElementById("editor")) {
    element.focus();
    if (typeof window.getSelection != "undefined" && typeof document.createRange != "undefined") {
        const range = window.getSelection().getRangeAt(0);
        const fragment = document.createRange().createContextualFragment(html);
        range.deleteContents(); 
        range.insertNode(fragment); 
    }
}


      function changeLineHeight(lineHeight) {
  const selection = window.getSelection();
  if (!selection.rangeCount) return;

  const range = selection.getRangeAt(0);
  if (range.collapsed) return;

  // Get all block elements that intersect the selection
  const blocks = getSelectedBlocks(range);

  blocks.forEach(block => {
    block.style.lineHeight = lineHeight;
  });
}


function getSelectedBlocks(range) {
  const blocks = new Set();

  const treeWalker = document.createTreeWalker(
    range.commonAncestorContainer,
    NodeFilter.SHOW_ELEMENT,
    {
      acceptNode: (node) => {
   
        if (isBlockElement(node)) {
     
          const nodeRange = document.createRange();
          nodeRange.selectNodeContents(node);
          if (
            range.compareBoundaryPoints(Range.END_TO_START, nodeRange) < 0 &&
            range.compareBoundaryPoints(Range.START_TO_END, nodeRange) > 0
          ) {
            return NodeFilter.FILTER_ACCEPT;
          }
        }
        return NodeFilter.FILTER_SKIP;
      }
    }
  );

  let currentNode = treeWalker.nextNode();
  while (currentNode) {
    blocks.add(currentNode);
    currentNode = treeWalker.nextNode();
  }

 
  if (blocks.size === 0) {
    const block = getBlockParent(range.startContainer);
    if (block) blocks.add(block);
  }

  return Array.from(blocks);
}


function isBlockElement(node) {
  return window.getComputedStyle(node).display === 'block' || 
         node.tagName === 'P' || node.tagName === 'DIV' || node.tagName === 'LI' || node.tagName === 'SECTION' || node.tagName === 'ARTICLE';
}


function getBlockParent(node) {
  while (node && node !== document.body) {
    if (node.nodeType === 1 && isBlockElement(node)) return node;
    node = node.parentNode;
  }
  return null;
}

      

  function changeFontSize(size) {
  const selection = window.getSelection();
  if (!selection.rangeCount) return;

  const range = selection.getRangeAt(0);

  if (range.collapsed) {
    const span = document.createElement('span');
    span.style.fontSize = size;
    span.appendChild(document.createTextNode('\u200B'));
    range.insertNode(span);

    const newRange = document.createRange();
    newRange.setStart(span.firstChild, 1);
    newRange.collapse(true);

    selection.removeAllRanges();
    selection.addRange(newRange);
  } else {
    const span = document.createElement('span');
    span.style.fontSize = size;
    span.appendChild(range.extractContents());
    range.insertNode(span);

    const newRange = document.createRange();
    newRange.selectNodeContents(span);
    selection.removeAllRanges();
    selection.addRange(newRange);
  }
}

      


 function insertImage() {
    const fileInput = document.createElement('input');
    fileInput.type = 'file';
    fileInput.accept = 'image/*';

    fileInput.addEventListener('change', function() {
        const file = this.files[0];

        if (file && file.type.startsWith('image/')) {
            const reader = new FileReader();

            reader.onload = function(event) {
                const imageUrl = event.target.result;

                const widthInput = prompt("Image size | Type 'fill' for 100% width");
                if (widthInput !== null) {
                    const editableDiv = document.getElementById('editor');
                    const img = document.createElement('img');
                    img.src = imageUrl;

                    const trimmedWidth = widthInput.trim();
                    const lowerCaseWidth = trimmedWidth.toLowerCase();

                    if (lowerCaseWidth === "fill") {
                        img.style.width = "100%";
                    } else if (lowerCaseWidth.endsWith("px") || lowerCaseWidth.endsWith("%")) {
                        img.style.width = lowerCaseWidth;
                    } else {
                        const parsedWidth = parseInt(trimmedWidth);
                        if (!isNaN(parsedWidth) && parsedWidth >= 1) {
                            img.style.width = parsedWidth + "px";
                        } else {
                            alert("Invalid width");
                            return;
                        }
                    }

                    editableDiv.appendChild(img);
                }
            };
            reader.readAsDataURL(file);
        } else if (file) {
            alert("Invalid file type. Please select an image file.");
        }
    });
    fileInput.click();
}

function insertLink() {
    
      let linkText = prompt("Enter the text for the link:");
      let linkURL = prompt("Enter the URL for the link:", "https://");

      if (linkText && linkURL) {
      
        let editor = document.getElementById("editor");
        editor.focus();

     
        let link = `&nbsp;<span class="link" contenteditable="true" onclick="openTab('${linkURL}');" target="_blank" contenteditable="false">${linkText}</span> &nbsp;`;

      
        document.execCommand("insertHTML", false, link);
      }
    }
    
       function insertCheckbox() {
       
            const checkboxHTML = '<span class="checkbox"><input type="checkbox" value=""></span>';
            const div = document.getElementById("editor");
            insertAtCaret(checkboxHTML, div);
           
        }

  function insertTable() {
  const size = prompt("What size do you want your table to be? (e.g 4 x 3, 6 x 9)", "4 x 3");
  if (!size) return;

  const [rows, cols] = size.toLowerCase().split("x").map(x => parseInt(x.trim()));
  if (isNaN(rows) || isNaN(cols)) {
    alert("Invalid format. Use 'rows x columns' (e.g., 3 x 4)");
    return;
  }

  let tableHTML = '<table border="1" style="border-collapse: collapse; width: 100%;">';
  for (let i = 0; i < rows; i++) {
    tableHTML += "<tr>";
    for (let j = 0; j < cols; j++) {
      tableHTML += `<td contenteditable="true" style="border: solid black 1px; background: transparent; padding: 20px;">Cell ${i * cols + j + 1}</td>`;
    }
    tableHTML += "</tr>";
  }
  tableHTML += "</table>";

  insertAtCaret(tableHTML);
}





function closeAddElements() {
   document.getElementById("addElements").style.display = "none";
}


      function toggleMenu() {
  const sidebar = document.querySelector(".sidebar");
  if (sidebar) {
    if (sidebar.style.display === "block") {
      sidebar.style.display = "none";
    } else {
      sidebar.style.display = "block";
    }
  } else {
    console.warn("Sidebar element not found");
  }
}



     function confirmChoice() {
  const selected = document.querySelector('.chrome-options li.selected');
  if (!selected) {
    alert('Please select an option first.');
    return;
  }

  const option = selected.textContent.trim();

    if (option === 'Save to Jamesy Creator') {
      hideOptions();
    saveDoc();
  } else if (option === 'Download as a .jcdoc' || option === 'Downloads') {
      hideOptions();
    saveToComputer();
  } else if (option === 'Save as a .pdf') {
      hideOptions();
    printContent(true); 
  } else if (option === 'Print') {
         printContent(true);
        } else {
    alert('Unknown option selected: ' + option);
  }

  hideOptions();
}



function addElement() {

  const selected = document.querySelector('#addElements .chrome-options li.selected');
  if (!selected) {
    alert('Please select an option first.');
    return;
  }

  const option = selected.textContent.trim();

  if (option === 'Table') {
    insertTable();
    closeAddElements(); 
  } else if (option === 'Link') {
    insertLink();
    closeAddElements();
  } else if (option === 'Checkbox') {
insertCheckbox();
closeAddElements();

  } else if (option === 'Image') { 
    insertImage();
    closeAddElements();
  } else {
    alert('Unknown option selected: ' + option);
  }
}




 

 
function changeFont(fontName) {
  const editor = document.getElementById('editor');
  const selection = window.getSelection();

  if (!selection.rangeCount) return;

  const range = selection.getRangeAt(0);
  if (range.collapsed) {

    const span = document.createElement('span');
    span.style.fontFamily = fontName;
    span.appendChild(document.createTextNode('\u200B')); 
    range.insertNode(span);
    
    
    range.setStartAfter(span);
    range.setEndAfter(span);
    selection.removeAllRanges();
    selection.addRange(range);
  } else {
  
    const span = document.createElement('span');
    span.style.fontFamily = fontName;
    span.appendChild(range.extractContents());
    range.insertNode(span);


    selection.removeAllRanges();
    const newRange = document.createRange();
    newRange.selectNodeContents(span);
    selection.addRange(newRange);
  }

  
  document.getElementById('fontChanger').value = '';
}


      

function showOptions() {
     document.getElementById("first_confirm").focus();
  document.getElementById("chromePrompt").style.display = "block";
}

function hideOptions() {
  document.getElementById("chromePrompt").style.display = "none";
}

function saveToCreator() {
  console.log("Saved to Jamesy Creator");
  hideOptions();
}

function saveToComputer() {
  console.log("Saved to Computer");
  hideOptions();
}

function addElements() {
     document.getElementById("second_confirm").focus();
   document.getElementById("addElements").style.display = "block";
}
    

    


      document.querySelectorAll('.chrome-options li').forEach(li => {
  li.addEventListener('click', () => {
 
    document.querySelectorAll('.chrome-options li').forEach(el => el.classList.remove('selected'));

    li.classList.add('selected');
    
    console.log("Selected save location:", li.textContent);
   
  });
});


      
      
    const storageKey = 'jcdocs';
    const openKey = 'jcdocsOpen';
    let docs = {};
    let openDocs = [];
    let current = null;

    function loadDocs() {
      try { return JSON.parse(localStorage.getItem(storageKey)) || {}; } catch(e) { return {}; }
    }
    function saveDocs() { localStorage.setItem(storageKey, JSON.stringify(docs)); }

    function loadOpen() {
      try { return JSON.parse(sessionStorage.getItem(openKey)) || []; } catch(e) { return []; }
    }
    function saveOpen() { sessionStorage.setItem(openKey, JSON.stringify(openDocs)); }

  function buildSidebar() {
  const list = document.getElementById('docList');
  list.innerHTML = '';

  
  const liOv = document.createElement('li');
  const aOv = document.createElement('a');
  aOv.textContent = 'Home';
  aOv.href = window.location.pathname;
  if (!current) aOv.classList.add('active');
  liOv.appendChild(aOv);
  list.appendChild(liOv);

  
  openDocs.forEach(name => {
    const li = document.createElement('li');
    const a = document.createElement('a');
    a.textContent = name;
    a.href = `?doc=${encodeURIComponent(name)}`;
    if (current === name) a.classList.add('active');
    li.appendChild(a);
    list.appendChild(li);
  });

  const liExit = document.createElement('li');
  const aExit = document.createElement('a');
  aExit.textContent = 'Exit';
  aExit.href = 'https://jamesy-tech.github.io/jamesy-creator/';
  liExit.appendChild(aExit);
  list.appendChild(liExit);
}

      
    function openDoc(name) {
      if (!openDocs.includes(name)) {
        openDocs.push(name);
        saveOpen();
      }
      window.location.search = `?doc=${encodeURIComponent(name)}`;
   }  

      
    function renderOverview() {
      current = null;
      docs = loadDocs();
      openDocs = loadOpen();
      buildSidebar();
      document.getElementById('statusName').textContent = 'My creations';
      document.getElementById('exportBtn').style.display = 'none';
      document.getElementById('closeBtn').style.display = 'none';
         document.getElementById('openBtn').style.display = 'none';
document.getElementById('saveBtn').style.display = 'none';
        document.getElementById('quit').style.display = '';

        document.getElementById('codeBtn').style.display = 'none';
         

      document.getElementById('deleteBtn').style.display = 'none';
      document.getElementById('contentArea').innerHTML = `
        <span class="overview_title">&#x2728; My creations</span>
        <ul id="overviewList"></ul>
       <span class="bottom_message">Create a new document by clicking the 'New' button at the top left of the page.</span><br>
      <span class="bottom_message">Can't find your old documents? <a class="bottom_message" href="classic_docs.html">Try checking Classic Docs</a>
      `;
      const ul = document.getElementById('overviewList');
      Object.keys(docs).forEach(name => {
        const li = document.createElement('li');
        const a = document.createElement('a');
        a.textContent = name;
        a.href = '#';
        a.onclick = () => openDoc(name);
        li.appendChild(a);
        ul.appendChild(li);
      });
    }


       function colorPick() {
                document.getElementById("colorPicker").click();
                  }

      
document.addEventListener("DOMContentLoaded", function () {
    const colorPicker = document.getElementById("colorPicker");
    const fakeColorPicker = document.getElementById("fakeColorPicker");

    fakeColorPicker.style.backgroundColor = colorPicker.value;

    colorPicker.addEventListener("input", function () {
        fakeColorPicker.style.backgroundColor = this.value;
    });
});


 
      

   
    function renderEditor(name) {
      current = name;
      docs = loadDocs();
      openDocs = loadOpen();
      buildSidebar();
      document.getElementById('statusName').textContent = name;
      document.getElementById('closeBtn').style.display = '';
         document.getElementById('openBtn').style.display = '';
document.getElementById('saveBtn').style.display = '';
        document.getElementById('codeBtn').style.display = '';
        
         
         document.getElementById('exportBtn').style.display = '';
      document.getElementById('deleteBtn').style.display = '';

        document.getElementById('quit').style.display = 'none';
        
     document.getElementById('contentArea').innerHTML = `

  

  <div id="editor" contenteditable="true" style="height: calc(100% - 40px); overflow-y: auto; padding-bottom: 50px;"></div>
  <div id="editorToolbar">

    <button onclick="addElements()">Elements</button>

 <input type="color" id="colorPicker" class="colorPicker" onchange="changeColour()" value="#000000">
            <div id="fakeColorPicker" class="ripple-button" onclick="colorPick()"></div> 
            <input type="color" class="colorPicker" value="#000000"> 

    <button onclick="document.execCommand('bold')" style="font-weight:bold;">B</button>
    <button onclick="document.execCommand('italic')" style="font-style:italic;font-family:'Roboto Mono';">I</button>
    <button onclick="document.execCommand('underline')" style="text-decoration:underline;">U</button>

<select id="fontSelector" onchange="changeFont(this.value)">
  <option value="Lato">Lato</option>
  <option value="Roboto Mono">Roboto Mono</option>
  <option value="Raleway">Raleway</option>
  <option value="Mulish">Mulish</option>
  <option value="Fira Sans">Fira Sans</option>
  <option value="IBM Plex Sans">IBM Plex Sans</option>
  <option value="Montserrat">Montserrat</option>
  <option value="Open Sans">Open Sans</option>
  <option value="Sora">Sora</option>
  <option value="Poppins">Poppins</option>
  <option value="Lilita One">Lilita One</option>
  <option value="Pacifico">Pacifico</option>
</select>
&nbsp;

<span style="font-size:14px; display:flex;">Size:</span>


<button onclick="changeFontSize('16px')">16px</button>
  <button onclick="changeFontSize('24px')">24px</button>
  <button onclick="changeFontSize('42px')">42px</button>
  <button onclick="changeFontSize('72px')">72px</button>

  
<!--

<button onclick="setFontSize('small')">Small</button>
  <button onclick="setFontSize('default')">Default</button>
  <button onclick="setFontSize('medium')">Medium</button>
    <button onclick="setFontSize('large')">Large</button>
 <button onclick="setFontSize('huge')">Huge</button> -->

&nbsp;


<span style="font-size:14px; display:flex;">Align:</span>
 
    <button class="b12" onclick="document.execCommand('justifyLeft');"><</button>
    
        <button class="b12" onclick="document.execCommand('justifyCenter');">=</button>
        
        <button class="b12" onclick="document.execCommand('justifyRight');">></button>

&nbsp;



<span style="font-size:14px; display:flex;">Line:</span>



    <button onclick="changeLineHeight('0.5')">0.5</button>
  <button onclick="changeLineHeight('1')">1</button>
  <button onclick="changeLineHeight('1.5')">1.5</button>
  <button onclick="changeLineHeight('2')">2</button>

   
  </div>
`;

      const editor = document.getElementById('editor');
      editor.innerHTML = docs[name] || '';
      editor.focus();
    }

    function newDoc() {
      const name = prompt('New document name', `doc${Date.now()}`);
      if (!name) return;
      docs[name] = '';
      saveDocs();
      openDocs = loadOpen();
      openDocs.push(name);
      saveOpen();
      openDoc(name);
    }

    function saveDoc() {
    
      if (!current) return;
      const content = document.getElementById('editor').innerHTML;
      docs[current] = content;
      saveDocs();
      const msg = document.getElementById('statusMsg');
      msg.textContent = 'Saved ✓';
      setTimeout(() => { msg.textContent = ''; }, 1500);

        console.log("Document saved");
        alert("Your document has been saved.");
        
    }

    function closeDoc() {
      openDocs = loadOpen();
      openDocs = openDocs.filter(n => n !== current);
      saveOpen();
      window.location.href = window.location.pathname;
    }

    function deleteDoc() {
      if (!current || !confirm(`Delete "${current}"? This cannot be undone.`)) return;
      delete docs[current];
      saveDocs();
      openDocs = loadOpen().filter(n => n !== current);
      saveOpen();
      window.location.href = window.location.pathname;
    }

    // Initialize
    docs = loadDocs();
    openDocs = loadOpen();
    const params = new URLSearchParams(window.location.search);
    const docName = params.get('doc');
    if (docName && docs.hasOwnProperty(docName)) {
      renderEditor(docName);
    } else {
      renderOverview();
    }


      let savedRange = null;

function saveSelection() {
  const sel = window.getSelection();
  if (sel && sel.rangeCount > 0) {
    savedRange = sel.getRangeAt(0).cloneRange();
  }
}

function restoreSelection() {
  const sel = window.getSelection();
  sel.removeAllRanges();
  if (savedRange) {
    sel.addRange(savedRange);
  }
}

document.addEventListener("DOMContentLoaded", function () {
  const colorPicker = document.getElementById("colorPicker");
  const fakeColorPicker = document.getElementById("fakeColorPicker");

  fakeColorPicker.style.backgroundColor = colorPicker.value;

  
  fakeColorPicker.addEventListener("mousedown", function () {
    saveSelection();
  });


  colorPicker.addEventListener("input", function () {
    const editor = document.getElementById("editor");
    editor.focus();

    
    setTimeout(() => {
      restoreSelection();
      const sel = window.getSelection();
      if (!sel.isCollapsed) {
        document.execCommand("styleWithCSS", false, true);
        document.execCommand("foreColor", false, colorPicker.value);
        fakeColorPicker.style.backgroundColor = colorPicker.value;
        saveSelection(); 
      }
    }, 0);
  });
});

      
function loadContent() {
  const fileInput = document.getElementById('fileInput');
  if (!fileInput) return;

  fileInput.accept = '.jcdoc';
  fileInput.click();

  fileInput.onchange = function(event) {
    const file = event.target.files[0];
    if (!file) return;

    if (!file.name.toLowerCase().endsWith('.jcdoc')) {
      alert('Only .jcdoc files are supported.');
      return;
    }

    const reader = new FileReader();
    reader.onload = function(e) {
      const content = e.target.result;
      const name = prompt('Name for imported document', file.name);
      if (!name) return;

      docs = loadDocs();
      docs[name] = content;
      saveDocs();

      openDocs = loadOpen();
      if (!openDocs.includes(name)) openDocs.push(name);
      saveOpen();

      openDoc(name);
    };
    reader.readAsText(file);
  };
}



  function saveToComputer() {
  if (!current) return;

  const content = docs[current] || '';
  const blob = new Blob([content], { type: 'text/html' });
  const url = URL.createObjectURL(blob);

  let filename = current;
  if (filename.toLowerCase().endsWith('.jcdoc')) {
    filename = filename.slice(0, -6);
  }
  filename += '.jcdoc';

  const a = document.createElement('a');
  a.href = url;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);

  URL.revokeObjectURL(url);

  const msg = document.getElementById('statusMsg');
  msg.textContent = 'Saved to computer';
  setTimeout(() => { msg.textContent = ''; }, 1500);
}




      function printContent(print) {

          document.getElementById("editorToolbar").style.display = "none";
    
    var content = document.getElementById('contentArea').innerHTML;

    var contentDiv = document.getElementById('contentArea');
    var computedStyle = window.getComputedStyle(contentDiv);
    
    var css = `
    
     @import url('https://fonts.googleapis.com/css2?family=Abel&family=Fascinate+Inline&family=Ga+Maamli&family=Happy+Monkey&family=Jaro:opsz@6..72&family=Kumbh+Sans:wght@100..900&family=Lilita+One&family=Lobster&family=Pacifico&family=Permanent+Marker&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Protest+Guerrilla&family=Quantico:ital,wght@0,400;0,700;1,400;1,700&family=Silkscreen:wght@400;700&family=Tiny5&family=VT323&display=swap');


            .add-button2 {
                 background:white;
                 border:solid whitesmoke 2px;
                 transition:0.3s;
                 margin-top:5px;
                 text-align:center;
                 cursor:pointer;
                 padding:5px;
                 font-family:verdana;
                 font-size:18px;
                 border-radius:10px;
                 outline:none;
             }

                 .add-button2:hover {
       background:whitesmoke;
                 }

                 #editor {
                 font-family:"Lato";
                 }
         
        body {
            background-color: ${computedStyle.backgroundColor};
            color: ${computedStyle.color};
            padding-bottom:0px;
            margin-bottom:0px;
            font-family: ${computedStyle.fontFamily};
            font-size: ${computedStyle.fontSize};
        }
        #contentDiv {
            padding: ${computedStyle.padding};
            margin: ${computedStyle.margin};
            border: ${computedStyle.border};
        }
    `;

   
    var printWin = window.open('', 'PrintWindow');
    

    printWin.document.write(`
        <html>
        <head>
        <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Afacad+Flux:wght@100..1000&family=Dosis:wght@200..800&family=Fira+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=IBM+Plex+Sans:ital,wght@0,100..700;1,100..700&family=Montserrat:ital,wght@0,100..900;1,100..900&family=Mulish:ital,wght@0,200..1000;1,200..1000&family=Open+Sans:ital,wght@0,300..800;1,300..800&family=Sora:wght@100..800&display=swap" rel="stylesheet">

<link rel="icon" href="images/docs.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=home" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&family=Mulish:ital,wght@0,200..1000;1,200..1000&family=Raleway:ital,wght@0,100..900;1,100..900&family=Roboto+Mono:ital,wght@0,100..700;1,100..700&display=swap" rel="stylesheet">

      <link rel="preconnect" href="https://fonts.googleapis.com">
   <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Rubik:ital,wght@0,300..900;1,300..900&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Afacad+Flux:wght@100..1000&family=Dosis:wght@200..800&family=Fira+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=IBM+Plex+Sans:ital,wght@0,100..700;1,100..700&family=Montserrat:ital,wght@0,100..900;1,100..900&family=Mulish:ital,wght@0,200..1000;1,200..1000&family=Open+Sans:ital,wght@0,300..800;1,300..800&family=Sora:wght@100..800&display=swap" rel="stylesheet">

    

            <title>Export</title>
            <style>${css}</style>
        </head>
        <body>
            ${content}
        </body>
        </html>
    `);

   
    printWin.document.close();

setTimeout(() => {
    
    if (print === true) {
         printWin.print();
    }

    }, 100);

          document.getElementById("editorToolbar").style.display = "";

    
}



      
  </script>
</body>
</html>
